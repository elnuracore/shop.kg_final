{% extends 'base.html' %}

{% block content %}
<div class="container mt-4">
    <h1 class="mb-4">–ù–∞—à–∏ –¢–æ–≤–∞—Ä—ã</h1>

    <div class="row mb-4">
        <div class="col-12">
            <form method="GET" action="{% url 'search' %}" class="d-flex gap-2">
                <input
                    type="text"
                    name="s" 
                    class="form-control"
                    placeholder="–ü–æ–∏—Å–∫ –ø–æ –Ω–∞–∑–≤–∞–Ω–∏—é..."
                    style="max-width: 300px;"
                    value="{{ request.GET.s|default:'' }}" 
                >
                <button type="submit" class="btn btn-dark">–ù–∞–π—Ç–∏</button>
                {% if request.GET.s %}
                    <a href="{% url 'search' %}" class="btn btn-outline-secondary">–°–±—Ä–æ—Å–∏—Ç—å</a>
                {% endif %}
            </form>
        </div>
    </div>
    
    <div class="row">
        {% for product in products %}
        <div class="col-md-4 mb-4">
            <div class="card h-100 shadow-sm">
                <div class="card-body d-flex flex-column">
                    <h5 class="card-title">{{ product.product_name }}</h5>
                    <p class="card-text">{{ product.description|truncatechars:100 }}</p>
                    
                    <div class="mb-2">
                        <span class="badge bg-info">{{ product.get_type_blog_display }}</span>
                        <small class="text-muted ms-2">–î–æ–±–∞–≤–ª–µ–Ω: {{ product.created_at|date:"d.m.Y" }}</small>
                    </div>
                    
                    <div class="mt-auto">
                        <div class="d-flex justify-content-between align-items-center mb-3">
                            <h4 class="text-success">{{ product.price }} KGS</h4>
                        </div>
                        
                        <div class="d-grid gap-2">
                            <a href="/product/{{ product.id }}/" class="btn btn-primary">
                                –ü–æ–¥—Ä–æ–±–Ω–µ–µ
                            </a>
                            
                            {% if request.user.is_authenticated %}
                            <form method="post" action="/basket/add/{{ product.id }}/">
                                {% csrf_token %}
                                <button type="submit" class="btn btn-success w-100">
                                    üõí –î–æ–±–∞–≤–∏—Ç—å –≤ –∫–æ—Ä–∑–∏–Ω—É
                                </button>
                            </form>
                            {% else %}
                            <a href="/users/login/?next={{ request.path }}" class="btn btn-outline-secondary">
                                –í–æ–π–¥–∏—Ç–µ —á—Ç–æ–±—ã –∫—É–ø–∏—Ç—å
                            </a>
                            {% endif %}
                        </div>
                    </div>
                </div>
            </div>
        </div>
        {% empty %}
        <div class="col-12 text-center mt-5">
            <h3>–ü–æ –≤–∞—à–µ–º—É –∑–∞–ø—Ä–æ—Å—É ¬´{{ request.GET.s }}¬ª –Ω–∏—á–µ–≥–æ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ.</h3>
            <a href="{% url 'search' %}" class="btn btn-link">–í–µ—Ä–Ω—É—Ç—å—Å—è –∫ —Å–ø–∏—Å–∫—É —Ç–æ–≤–∞—Ä–æ–≤</a>
        </div>
        {% endfor %}
    </div>
</div>
{% endblock %}